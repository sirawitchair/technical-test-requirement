SELECT 
    w.AGREEMENT_NO, 
    w.OUTSTANDING_BALANCE, 
    j.JUDGE_TYPE,
    CASE 
        WHEN w.OUTSTANDING_BALANCE < 50000 THEN 'กลุ่มที่ 1'
        WHEN w.OUTSTANDING_BALANCE >= 50000 AND (j.JUDGE_TYPE NOT IN (1, 2) OR j.JUDGE_TYPE IS NULL) THEN 'กลุ่มที่ 2'
        WHEN w.OUTSTANDING_BALANCE >= 50000 AND j.JUDGE_TYPE IN (1, 2) THEN 'กลุ่มที่ 3'
    END AS Group_Name,
    w.AGE_OF_WRITE_OFF,
    w.AUTO_TYPE_NAME
FROM TB_DATA_WO w
LEFT JOIN TB_DATA_JUDETYPE j ON w.AGREEMENT_NO = j.AGREEMENT_NO
WHERE NOT EXISTS (
    SELECT 1 FROM TB_CAR_CASE c 
    WHERE c.AGREEMENT_NO = w.AGREEMENT_NO
);